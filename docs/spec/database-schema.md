# Database Schema Specification

## Overview
The book management system uses PostgreSQL with two main tables: `users` for authentication and `books` for catalog management.

## Tables

### users
User authentication and profile management table.

```sql
CREATE TABLE users (
    id VARCHAR(100) PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    role VARCHAR(20) NOT NULL,
    status VARCHAR(20) NOT NULL,
    created_date timestamptz NOT NULL,
    updated_date timestamptz NOT NULL,
    deleted_date timestamptz
);

-- Indexes
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_users_status ON users(status);
```

#### Fields Description
- `id`: Primary key, application-generated string ID
- `email`: Unique user email for login
- `password_hash`: Bcrypt hashed password
- `first_name`: User's first name
- `last_name`: User's last name
- `role`: User role (`admin` | `member`)
- `status`: Account status (`active` | `inactive`)
- `created_date`: Record creation timestamp (UTC)
- `updated_date`: Record last update timestamp (UTC)
- `deleted_date`: Soft delete timestamp (NULL = active, NOT NULL = deleted)

### books
Book catalog and inventory management table.

```sql
CREATE TABLE books (
    id VARCHAR(100) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    author VARCHAR(255) NOT NULL,
    isbn VARCHAR(20) UNIQUE,
    publisher VARCHAR(255),
    publication_year INTEGER,
    genre VARCHAR(100),
    description TEXT,
    pages INTEGER,
    language VARCHAR(50) NOT NULL,
    price DECIMAL(10,2),
    quantity INTEGER NOT NULL,
    available_quantity INTEGER NOT NULL,
    location VARCHAR(100),
    status VARCHAR(20) NOT NULL,
    created_date timestamptz NOT NULL,
    updated_date timestamptz NOT NULL,
    deleted_date timestamptz
);

-- Indexes
CREATE INDEX idx_books_title ON books(title);
CREATE INDEX idx_books_author ON books(author);
CREATE UNIQUE INDEX idx_books_isbn ON books(isbn) WHERE isbn IS NOT NULL;
CREATE INDEX idx_books_genre ON books(genre);
CREATE INDEX idx_books_status ON books(status);
```

#### Fields Description
- `id`: Primary key, application-generated string ID
- `title`: Book title (searchable)
- `author`: Author name (searchable)
- `isbn`: International Standard Book Number (unique)
- `publisher`: Publishing company
- `publication_year`: Year of publication
- `genre`: Book category/genre
- `description`: Book summary/description
- `pages`: Number of pages
- `language`: Book language (required)
- `price`: Book price (decimal)
- `quantity`: Total number of copies (required)
- `available_quantity`: Currently available copies (required)
- `location`: Physical location (shelf/section)
- `status`: Book availability status (required)
- `created_date`: Record creation timestamp (UTC)
- `updated_date`: Record last update timestamp (UTC)
- `deleted_date`: Soft delete timestamp (NULL = active, NOT NULL = deleted)

## Data Constraints

### Business Rules
1. **Email Uniqueness**: Each user must have a unique email address
2. **ISBN Uniqueness**: If provided, ISBN must be unique across all books
3. **Inventory Logic**: `available_quantity` should never exceed `quantity`
4. **Role Validation**: User role must be either 'admin' or 'member'
5. **Status Validation**: User status must be 'active' or 'inactive'
6. **Book Status**: Book status must be 'available' or 'unavailable'
7. **Soft Delete Logic**: Records with `deleted_date IS NULL` are active, `IS NOT NULL` are deleted

### ID Generation
- **Application Responsibility**: All ID values are generated by the application, not the database
- **Format**: String IDs up to 100 characters (UUID, ULID, or custom format)
- **Database Role**: Database only enforces uniqueness via PRIMARY KEY constraint

### Required Fields (NOT NULL)
- **users**: id, email, password_hash, first_name, last_name, role, status, created_date, updated_date
- **books**: id, title, author, language, quantity, available_quantity, status, created_date, updated_date

### Optional Fields (Nullable)
- **users**: deleted_date
- **books**: isbn, publisher, publication_year, genre, description, pages, price, location, deleted_date

### No Default Values
- **Database Level**: No DEFAULT constraints in database schema
- **Application Level**: Application code handles all default value assignment

## Environment Configuration

Database connection requires these environment variables:
```bash
BOOKMS_DB_HOST=localhost
BOOKMS_DB_PORT=5432
BOOKMS_DB_USER=bookms_user
BOOKMS_DB_PASSWORD=secure_password
BOOKMS_DB_NAME=book_management
BOOKMS_DB_MAX_OPEN_CONNS=25
BOOKMS_DB_MAX_IDLE_CONNS=5
BOOKMS_DB_CONN_MAX_LIFETIME=300
```

## Migration Notes
- All timestamps use `timestamptz` and stored in UTC
- Password hashing uses bcrypt with cost 12
- Database connection pool configured via environment variables
- Indexes optimized for search operations on title, author, and email
- ID generation handled by application (UUID/ULID recommended)
- No database-level defaults - application manages all default values
- Soft delete via `deleted_date` column (NULL = active, NOT NULL = deleted)
